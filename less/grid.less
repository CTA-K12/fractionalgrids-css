//
// Grid system
// --------------------------------------------------
// Author: Curtis G Hanson, MESD <chanson@mesd.k12.or.us>
// Licensed under http://www.apache.org/licenses/LICENSE-2.0
// MIT License
//

// Set the container width, and override it for fixed navbars in media queries
.container {
    .container-fixed();
}

// mobile first defaults
.row {
    .make-row();
}

div[class^='col-'],
div[class*=' col-'] {
    position:                      relative;
    min-height:                         1px;
    padding-left:  (@grid-gutter-width / 2);
    padding-right: (@grid-gutter-width / 2);
    float:                             left;
}

// demo styles
div[class^='col-'],
div[class*=' col-'] {
    padding-top: 10px;
    padding-bottom: 10px;
    background-color: #eee;
    background-color: rgba(86,61,124,.15);
    border: 1px solid #ddd;
    border: 1px solid rgba(86,61,124,.2);
}

.get-gcds (@grid-columns);

.column-maker (@gcd-len, @grid-columns, @gcd-arr, xs);


@media (min-width: @screen-sm-min) {
    .container {
        width: @container-sm;
    }
    .column-maker (@gcd-len, @grid-columns, @gcd-arr, sm);
}

@media (min-width: @screen-md-min) {
    .container {
        width: @container-md;
    }
    .column-maker (@gcd-len, @grid-columns, @gcd-arr, md);
}

@media (min-width: @screen-lg-min) {
    .container {
        width: @container-lg;
    }
    .column-maker (@gcd-len, @grid-columns, @gcd-arr, lg);
}

.get-gcds (@cols) {
    @gcd-arr: ~`(function(c){var f=[];for(var d=c;d>0;d--){for(var n=d;n>0;n--){function r(n,d){var g=function g(a,b){return b?g(b,a%b):a;};g=g(n,d);return (n/g)+"-"+(d/g);}var g=r(n,d);if(-1===f.indexOf(g))f.push(g);}}return f.join(",");})("@{cols}")`;
    @gcd-len: ~`(function(c){ return c.split(",").length})("@{gcd-arr}")`;
}

.column-maker (@totalgcds, @totalcols, @gcdsarray, @size) {

    // looper function
    .gcd-loop (@k) when (@k > 0) {

        // get current gcd
        @currgcd: ~`(function(g,i){return g.split(",")[i-1]})("@{gcdsarray}","@{k}")`;
        @temp-span-2: ~'';
        @temp-push-2: ~'';
        @temp-pull-2: ~'';
        @temp-offset-2: ~'';

        // looper function
        .denomenator-loop (@j, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2) when (@j > 0) {

            // looper function
            .numerator-loop (@i, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2) when (@i > 0) {

                // get testing gcd
                @testgcd: ~`(function(n,d){var g=function g(a,b){return b?g(b,a%b):a;};g=g(n,d);return (n/g)+"-"+(d/g);})("@{i}","@{j}")`;
                
                // if @gcd === gcd(numerator/denominator)
                // add it to the selectors

                // when it's the first find
                .compare(@curr, @test, @temp-span-1, @temp-push-1, @temp-pull-1, @temp-offset-1, @size) when (@test = @curr) and (@temp-span-1 = ~'') {
                    @temp-span-2:   ".col-@{size}-@{i}-@{j}";
                    @temp-push-2:   ".col-@{size}-push-@{i}-@{j}";
                    @temp-pull-2:   ".col-@{size}-pull-@{i}-@{j}";
                    @temp-offset-2: ".col-@{size}-offset-@{i}-@{j}";
                }

                // when it's not the first find and type is empty
                .compare(@curr, @test, @temp-span-1, @temp-push-1, @temp-pull-1, @temp-offset-1, @size) when (@test = @curr) and not (@temp-span-1 = ~'') {
                    @temp-span-2:   "@{temp-span-1}, .col-@{size}-@{i}-@{j}";
                    @temp-push-2:   "@{temp-push-1}, .col-@{size}-push-@{i}-@{j}";
                    @temp-pull-2:   "@{temp-pull-1}, .col-@{size}-pull-@{i}-@{j}";
                    @temp-offset-2: "@{temp-offset-1}, .col-@{size}-offset-@{i}-@{j}";
                }

                .compare(@currgcd, @testgcd, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2, @size);

                // print when i and j are 1
                .printitout (@t-span, @t-push, @t-pull, @t-offset, @a, @b) when (@a = 1) and (@b = 1) {
                    @s-span:   ~"@{t-span}";
                    @s-push:   ~"@{t-push}";
                    @s-pull:   ~"@{t-pull}";
                    @s-offset: ~"@{t-offset}";
                    @percent:  `(function(x){var y=x.split("-");return y[0]/y[1];})("@{currgcd}")`;
                    @{s-span} {
                        width: percentage(@percent);
                    }
                    @{s-push} {
                        left: percentage(@percent);
                    }
                    @{s-pull} {
                        right: percentage(@percent);
                    }
                    @{s-offset} {
                        left-margin: percentage(@percent);
                    }
                }

                .printitout (@temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2, @i, @j);

                // next iteration
                .numerator-loop (@i - 1, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2);
            }

            // start the numerator loop
            .numerator-loop (@j, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2);

            // next iteration
            .denomenator-loop (@j - 1, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2);

        }

        // start the denomenator loop with highest column count
        .denomenator-loop (@totalcols, @temp-span-2, @temp-push-2, @temp-pull-2, @temp-offset-2);

        // next iteration
        .gcd-loop (@k - 1);
    }

    // start the gcd loop
    .gcd-loop (@totalgcds);
}
